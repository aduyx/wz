<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>后台—内容/资讯管理 - AI智货代</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/global.css">
  <script src="/assets/js/global.js?v=20251114"></script>
</head>
<body class="bg-gray-50 font-sans text-dark">
  <div id="header-container"></div>
  <main class="container mx-auto px-4 py-8">
    <div class="flex items-center justify-between mb-4">
      <h1 class="text-2xl font-bold">内容与首页区块管理</h1>
      <a href="/pages/admin/index.html" class="text-primary hover:underline"><i class="fas fa-arrow-left mr-2"></i>返回仪表盘</a>
    </div>

    <!-- 1. 首页头部横幅（Hero）配置 -->
    <section class="bg-white rounded-lg shadow p-6 border border-blue-200 mb-6">
      <h2 class="text-xl font-semibold mb-3 flex items-center"><i class="fas fa-heading mr-2 text-blue-600"></i>首页头部横幅（Hero）配置</h2>
      <p class="text-gray-600 text-sm mb-4">设置首页顶部横幅的背景、主标题、副标题、两个按钮的文本与链接。此处与“站点设置”中的横幅配置保持一致。</p>
      <form id="hero-config-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <label class="block">
          <span class="text-sm">背景（颜色/渐变）</span>
          <input id="hero-bg" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：linear-gradient(90deg, #4f46e5, #06b6d4)">
        </label>
        <label class="block">
          <span class="text-sm">主标题</span>
          <input id="hero-title" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：AI智货代，为您赋能">
        </label>
        <label class="block md:col-span-2">
          <span class="text-sm">副标题</span>
          <input id="hero-subtitle" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：更快的查询、更准的追踪、更好的服务体验">
        </label>
        <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm">按钮1文本</label>
            <input id="hero-btn1-text" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：开始使用">
            <label class="block text-sm mt-2">按钮1链接</label>
            <input id="hero-btn1-link" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：/pages/tools/index.html">
          </div>
          <div>
            <label class="block text-sm">按钮2文本</label>
            <input id="hero-btn2-text" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：查看价格">
            <label class="block text-sm mt-2">按钮2链接</label>
            <input id="hero-btn2-link" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：/pages/pricing/index.html">
          </div>
        </div>
        <div class="md:col-span-2 flex gap-3 mt-2">
          <button type="button" id="hero-save" class="btn-primary"><i class="fas fa-save mr-2"></i>保存横幅配置</button>
          <button type="button" id="hero-reset" class="btn-secondary"><i class="fas fa-undo mr-2"></i>恢复默认</button>
        </div>
      </form>
    </section>

    <!-- 集装箱追踪设置 -->
    <section class="bg-white rounded-lg shadow p-6 border border-purple-200 mb-6">
      <h2 class="text-xl font-semibold mb-3 flex items-center"><i class="fas fa-search mr-2 text-purple-500"></i>首页“集装箱追踪”设置</h2>
      <p class="text-gray-600 text-sm mb-4">配置追踪区块的标题、占位符、按钮与帮助链接，同时设置输入校验规则。</p>
      <form id="tracking-settings-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <label class="block">
          <span class="text-sm">标题</span>
          <input id="track-title" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：集装箱追踪查询">
        </label>
        <label class="block">
          <span class="text-sm">按钮文字</span>
          <input id="track-button-text" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：查询">
        </label>
        <label class="block md:col-span-2">
          <span class="text-sm">输入框占位符</span>
          <input id="track-placeholder" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：请输入提单号或箱号">
        </label>
        <label class="block">
          <span class="text-sm">帮助链接文字</span>
          <input id="track-link-text" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：申请加入船东">
        </label>
        <label class="block">
          <span class="text-sm">帮助链接地址</span>
          <input id="track-help-link-href" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：/pages/contact/index.html#apply-owner">
        </label>
        <label class="block">
          <span class="text-sm">箱号正则</span>
          <input id="track-container-regex" class="mt-1 w-full border rounded px-3 py-2" placeholder="默认：^[A-Z]{4}\\d{7,8}$">
        </label>
        <label class="block">
          <span class="text-sm">提单号正则</span>
          <input id="track-bl-regex" class="mt-1 w-full border rounded px-3 py-2" placeholder="默认：^[A-Z0-9\\-]{5,20}$">
        </label>
        <label class="block md:col-span-2">
          <span class="text-sm">无效输入提示</span>
          <input id="track-invalid-tip" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：输入不符合规则，请按要求输入箱号或提单号。">
        </label>
        <div class="md:col-span-2 flex gap-3 mt-1">
          <button type="button" id="track-save" class="btn-primary"><i class="fas fa-save mr-2"></i>保存设置</button>
          <button type="button" id="track-reset" class="btn-secondary"><i class="fas fa-undo mr-2"></i>恢复默认</button>
        </div>
      </form>
    </section>

    

    <!-- 首页行业快讯维护 -->
    <section class="bg-white rounded-lg shadow p-6 border border-green-200 mb-6">
      <h2 class="text-xl font-semibold mb-3 flex items-center"><i class="fas fa-newspaper mr-2 text-green-600"></i>首页“行业快讯”维护</h2>
      <p class="text-gray-600 text-sm mb-4">设置首页显示的文章卡片（仅用于首页展示，不影响资讯文章库）。</p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
        <input id="news-title" class="border rounded px-3 py-2" placeholder="标题">
        <input id="news-summary" class="border rounded px-3 py-2" placeholder="摘要">
        <input id="news-href" class="border rounded px-3 py-2" placeholder="链接，如：/news.html#id">
      </div>
      <div class="flex gap-3 mb-4">
        <button type="button" id="news-add" class="btn-primary"><i class="fas fa-plus mr-2"></i>添加</button>
        <button type="button" id="news-save" class="btn-secondary"><i class="fas fa-save mr-2"></i>保存</button>
        <button type="button" id="news-clear" class="btn-secondary"><i class="fas fa-trash mr-2"></i>清空</button>
      </div>
      <ul id="news-list" class="list-disc pl-5 text-sm"></ul>
    </section>

    <!-- 资讯文章库维护（供 news.html 页面使用） -->
    <section class="bg-white rounded-lg shadow p-6 border border-blue-200 mb-6">
      <h2 class="text-xl font-semibold mb-2 flex items-center"><i class="fas fa-database mr-2 text-blue-600"></i>资讯文章库维护（已迁移）</h2>
      <div class="mb-3 p-3 border-l-4 border-yellow-500 bg-yellow-50 text-sm text-yellow-700">
        此处的文章库维护功能已迁移至独立页面“新闻库管理”。为避免数据来源混乱，请前往新页面进行管理：
        <a class="text-blue-600 underline ml-1" href="/pages/admin/news.html#library"><i class="fas fa-arrow-right mr-1"></i>打开新闻库管理</a>
      </div>
      <p class="text-gray-600 text-sm mb-4">以下旧版控件保留为只读展示。添加、保存、导入、导出、清空等操作已禁用并会跳转到新页面。</p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
        <input id="newslib-title" class="border rounded px-3 py-2" placeholder="标题">
        <input id="newslib-summary" class="border rounded px-3 py-2" placeholder="摘要">
        <input id="newslib-href" class="border rounded px-3 py-2" placeholder="链接，如：/pages/news/detail.html">
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3 items-center">
        <div>
          <label class="block text-sm">封面地址</label>
          <input id="newslib-cover-url" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：https://... 或留空使用下方上传">
        </div>
        <div class="flex items-center gap-3">
          <label class="text-sm">上传封面：
            <input type="file" id="newslib-cover-file" accept="image/*" class="ml-2">
          </label>
        </div>
        <div>
          <label class="block text-sm">来源</label>
          <input id="newslib-source" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：官方公告/媒体/自采">
        </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-3 items-center">
        <div>
          <label class="block text-sm">发布时间</label>
          <input id="newslib-publish" type="datetime-local" class="mt-1 w-full border rounded px-3 py-2">
        </div>
        <div>
          <label class="block text-sm">标签（逗号分隔）</label>
          <input id="newslib-tags" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：航线,运价,港口">
        </div>
        <div>
          <label class="block text-sm">热度（数值）</label>
          <input id="newslib-heat" type="number" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：100">
        </div>
        <div class="flex items-center gap-2 mt-6">
          <input id="newslib-pinned" type="checkbox" class="border rounded">
          <label for="newslib-pinned" class="text-sm">设为置顶</label>
        </div>
      </div>
      <div class="flex gap-3 mb-4 opacity-60 pointer-events-none" title="功能已迁移至 新闻库管理">
        <button type="button" id="newslib-add" class="btn-primary" disabled><i class="fas fa-plus mr-2"></i>添加到文章库</button>
        <button type="button" id="newslib-export" class="btn-secondary" disabled><i class="fas fa-download mr-2"></i>导出JSON</button>
        <label class="btn-secondary cursor-not-allowed" title="功能已迁移" disabled><i class="fas fa-upload mr-2"></i>导入JSON
          <input type="file" id="newslib-import-file" accept="application/json" class="hidden" disabled>
        </label>
        <button type="button" id="newslib-clear" class="btn-secondary" disabled><i class="fas fa-trash mr-2"></i>清空文章库</button>
      </div>
      <table class="w-full text-sm border">
        <thead>
          <tr class="bg-gray-100">
            <th class="p-2 border">封面</th>
            <th class="p-2 border">标题/摘要</th>
            <th class="p-2 border">发布时间</th>
            <th class="p-2 border">标签</th>
            <th class="p-2 border">热度</th>
            <th class="p-2 border">链接</th>
            <th class="p-2 border">置顶</th>
            <th class="p-2 border">操作</th>
          </tr>
        </thead>
        <tbody id="newslib-table"></tbody>
      </table>
    </section>

    <!-- 资讯侧边栏配置：作者/嘉宾/标签 -->
    <section class="bg-white rounded-lg shadow p-6 border border-pink-200 mb-6">
      <h2 class="text-xl font-semibold mb-2 flex items-center"><i class="fas fa-user-pen mr-2 text-pink-600"></i>资讯侧边栏配置</h2>
      <p class="text-gray-600 text-sm mb-4">配置 news.html 右侧栏的作者信息、特邀嘉宾与标签。写入 localStorage 后页面将自动联动。</p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
        <div class="md:col-span-1 border rounded p-3">
          <h3 class="font-semibold mb-2 flex items-center text-sm"><i class="fas fa-user-circle mr-2 text-pink-500"></i>作者信息</h3>
          <label class="block text-sm">作者名称</label>
          <input id="side-author-name" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：AI智货代编辑部">
          <label class="block text-sm mt-2">作者简介</label>
          <input id="side-author-bio" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：聚焦航运与货代行业趋势与干货分享。">
          <label class="block text-sm mt-2">头像地址</label>
          <input id="side-author-avatar-url" class="mt-1 w-full border rounded px-3 py-2" placeholder="如：/assets/images/logo.webp 或 https://...">
          <div class="mt-2 text-sm">上传头像：<input type="file" id="side-author-avatar-file" accept="image/*" class="ml-2"></div>
          <button type="button" id="side-author-save" class="btn-primary mt-3"><i class="fas fa-save mr-2"></i>保存作者信息</button>
        </div>
        <div class="md:col-span-2 border rounded p-3">
          <h3 class="font-semibold mb-2 flex items-center text-sm"><i class="fas fa-users mr-2 text-pink-500"></i>特邀嘉宾</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-2">
            <input id="side-guest-name" class="border rounded px-3 py-2" placeholder="嘉宾名称">
            <input id="side-guest-intro" class="border rounded px-3 py-2" placeholder="嘉宾介绍">
            <input id="side-guest-avatar-url" class="border rounded px-3 py-2" placeholder="头像地址或留空使用下方上传">
          </div>
          <div class="mb-2 text-sm">上传头像：<input type="file" id="side-guest-avatar-file" accept="image/*" class="ml-2"></div>
          <div class="flex gap-2 mb-3">
            <button type="button" id="side-guest-add" class="btn-primary"><i class="fas fa-plus mr-2"></i>添加嘉宾</button>
            <button type="button" id="side-guests-clear" class="btn-secondary"><i class="fas fa-trash mr-2"></i>清空嘉宾</button>
          </div>
          <table class="w-full text-sm border">
            <thead>
              <tr class="bg-gray-100">
                <th class="p-2 border">头像</th>
                <th class="p-2 border">信息</th>
                <th class="p-2 border">操作</th>
              </tr>
            </thead>
            <tbody id="side-guests-table"></tbody>
          </table>
        </div>
      </div>
      <div class="border rounded p-3">
        <h3 class="font-semibold mb-2 flex items-center text-sm"><i class="fas fa-tags mr-2 text-pink-500"></i>标签</h3>
        <div class="flex items-center gap-3 mb-2">
          <input id="side-tags-input" class="flex-1 border rounded px-3 py-2" placeholder="逗号分隔，如：航线,港口,集装箱,运价">
          <button type="button" id="side-tags-save" class="btn-primary"><i class="fas fa-save mr-2"></i>保存标签</button>
        </div>
        <div class="text-xs text-gray-600">当前标签：<span id="side-tags-list" class="font-mono"></span></div>
      </div>
    </section>

    <!-- 4. 首页船东卡片维护（与下拉区分） -->
    <section class="bg-white rounded-lg shadow p-6 border border-sky-200 mb-6">
      <h2 class="text-xl font-semibold mb-3 flex items-center"><i class="fas fa-id-card mr-2 text-sky-600"></i>首页“船东卡片”维护</h2>
      <p class="text-gray-600 text-sm mb-4">维护首页展示的船东卡片（名称、Logo、链接）。同时作为首页“集装箱追踪”船东下拉与跳转的数据源。</p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
        <input id="home-owner-name" class="border rounded px-3 py-2" placeholder="船东名称">
        <input id="home-owner-logo" class="border rounded px-3 py-2" placeholder="Logo地址（或留空使用下方上传）">
        <input id="home-owner-link" class="border rounded px-3 py-2" placeholder="链接，如：/pages/tracking/index.html">
      </div>
      <div class="flex items-center gap-3 mb-3">
        <label class="text-sm text-gray-700">上传Logo图片：
          <input type="file" id="home-owner-logo-file" accept="image/*" class="ml-2">
        </label>
      </div>
      <div class="flex gap-3 mb-3">
        <button type="button" id="home-owner-add" class="btn-primary"><i class="fas fa-plus mr-2"></i>添加</button>
        <button type="button" id="home-owner-clear" class="btn-secondary"><i class="fas fa-trash mr-2"></i>清空</button>
        <button type="button" id="home-owner-sync-static" class="btn-secondary"><i class="fas fa-sync mr-2"></i>从首页同步（静态列表）</button>
      </div>
      <div class="border rounded p-3 bg-gray-50 mb-3">
        <div class="font-semibold text-sm mb-2">批量导入（CSV）</div>
        <div class="flex items-center gap-3">
          <label class="btn-secondary cursor-pointer"><i class="fas fa-upload mr-2"></i>导入CSV文件
            <input type="file" id="home-owner-bulk-file" accept=".csv" class="hidden">
          </label>
          <button type="button" id="home-owner-load-txt" class="btn-secondary"><i class="fas fa-file-import mr-2"></i>从项目TXT加载</button>
        </div>
        <div class="text-xs text-gray-600 mt-2">CSV列顺序：船东名称, 链接, 图片（Logo）。示例：MSC, https://www.msc.com/track/{query}, https://example.com/logo.png</div>
      </div>
      <table class="w-full text-sm border">
        <thead>
          <tr class="bg-gray-100">
            <th class="p-2 border">名称</th>
            <th class="p-2 border">Logo（预览/替换）</th>
            <th class="p-2 border">链接</th>
            <th class="p-2 border">操作</th>
          </tr>
        </thead>
        <tbody id="home-owner-table"></tbody>
      </table>
    </section>

    <!-- 5. 运价查询配置（端口数据库 + 跳转链接） -->
    <!-- 5+. 首页运价播报维护（用于首页运价查询卡片顶部滚动播报） -->
    <section class="bg-white rounded-lg shadow p-6 border border-amber-200 mb-6">
      <h2 class="text-xl font-semibold mb-3 flex items-center"><i class="fas fa-bullhorn mr-2 text-amber-500"></i>首页“运价播报”维护</h2>
      <p class="text-gray-600 text-sm mb-4">此播报显示在首页右侧“运价查询”卡片顶部的滚动区域。配置后将实时同步到首页。</p>
      <div class="flex items-center gap-3 mb-2">
        <input id="freight-marquee-input" class="flex-1 border rounded px-3 py-2" placeholder="请输入滚动播报文本，如：热门航线更新：亚洲→北美...">
        <button type="button" id="freight-marquee-save" class="btn-primary"><i class="fas fa-save mr-2"></i>保存</button>
        <button type="button" id="freight-marquee-clear" class="btn-secondary"><i class="fas fa-trash mr-2"></i>清空</button>
      </div>
      <div class="text-xs text-gray-600">提示：保存后写入浏览器 localStorage（键：<code>freight_marquee</code>），首页会自动刷新显示。</div>
    </section>

    <section class="bg-white rounded-lg shadow p-6 border border-indigo-200 mb-6">
      <h2 class="text-xl font-semibold mb-3 flex items-center"><i class="fas fa-route mr-2 text-indigo-600"></i>运价查询配置</h2>
      <p class="text-gray-600 text-sm mb-4">维护起运港与目的港（批量CSV导入），并设置运价查询跳转链接。</p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3 items-center">
        <label class="btn-secondary cursor-pointer"><i class="fas fa-file-csv mr-2"></i>导入CSV文件
          <input type="file" id="ports-csv-file" accept=".csv" class="hidden">
        </label>
        <input id="freight-link" class="border rounded px-3 py-2" placeholder="运价查询跳转链接，如：/pages/pricing/index.html">
        <button type="button" id="port-clear" class="btn-secondary"><i class="fas fa-trash mr-2"></i>清空端口库</button>
      </div>
      <table class="w-full text-sm border mb-3">
        <thead>
          <tr class="bg-gray-100">
            <th class="p-2 border">起运港</th>
            <th class="p-2 border">目的港</th>
            <th class="p-2 border">港口代码</th>
            <th class="p-2 border">操作</th>
          </tr>
        </thead>
        <tbody id="ports-table"></tbody>
      </table>
      <div class="text-xs text-gray-600">CSV列顺序：起运港, 目的港, 港口代码。示例：上海, 洛杉矶, CNSHA</div>
    </section>

    <!-- 新增：起运港库（独立维护，后期可与目的港合并） -->
    <section class="bg-white rounded-lg shadow p-6 border border-green-200 mb-6">
      <h2 class="text-xl font-semibold mb-3 flex items-center"><i class="fas fa-anchor mr-2 text-green-600"></i>起运港库（独立）</h2>
      <p class="text-gray-600 text-sm mb-3">说明：前期单独维护起运港，字段建议：中文名、英文名、港口代码、别名（逗号分隔）。</p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3 items-center">
        <label class="btn-secondary cursor-pointer"><i class="fas fa-file-csv mr-2"></i>导入CSV
          <input type="file" id="origin-ports-csv-file" accept=".csv" class="hidden">
        </label>
        <button type="button" id="origin-ports-load-txt" class="btn-secondary"><i class="fas fa-file-import mr-2"></i>从项目TXT加载</button>
        <button type="button" id="origin-port-map" class="btn-secondary"><i class="fas fa-map-marked-alt mr-2"></i>映射UN/LOCODE</button>
        <button type="button" id="origin-port-clear" class="btn-secondary"><i class="fas fa-trash mr-2"></i>清空起运港库</button>
        <button type="button" id="origin-port-add" class="btn-secondary"><i class="fas fa-plus mr-2"></i>新增一条</button>
      </div>
      <table class="w-full text-sm border mb-3">
        <thead>
          <tr class="bg-gray-100">
            <th class="p-2 border">中文名</th>
            <th class="p-2 border">英文名</th>
            <th class="p-2 border">港口代码</th>
            <th class="p-2 border">别名（逗号分隔）</th>
            <th class="p-2 border">操作</th>
          </tr>
        </thead>
        <tbody id="origin-ports-table"></tbody>
      </table>
      <div class="text-xs text-gray-600">CSV表头支持：cn,en,code,aliases 或 中文名,英文名,港口代码,别名</div>
    </section>

    <!-- 新增：目的港库（独立维护，后期可与起运港合并） -->
    <section class="bg-white rounded-lg shadow p-6 border border-purple-200 mb-6">
      <h2 class="text-xl font-semibold mb-3 flex items-center"><i class="fas fa-flag-checkered mr-2 text-purple-600"></i>目的港库（独立）</h2>
      <p class="text-gray-600 text-sm mb-3">说明：前期单独维护目的港，字段建议：中文名、英文名、港口代码、别名（逗号分隔）。</p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3 items-center">
        <label class="btn-secondary cursor-pointer"><i class="fas fa-file-csv mr-2"></i>导入CSV
          <input type="file" id="dest-ports-csv-file" accept=".csv" class="hidden">
        </label>
        <button type="button" id="dest-ports-load-txt" class="btn-secondary"><i class="fas fa-file-import mr-2"></i>从项目TXT加载</button>
        <button type="button" id="dest-port-map" class="btn-secondary"><i class="fas fa-map-marked-alt mr-2"></i>映射UN/LOCODE</button>
        <button type="button" id="dest-port-clear" class="btn-secondary"><i class="fas fa-trash mr-2"></i>清空目的港库</button>
        <button type="button" id="dest-port-add" class="btn-secondary"><i class="fas fa-plus mr-2"></i>新增一条</button>
      </div>
      <table class="w-full text-sm border mb-3">
        <thead>
          <tr class="bg-gray-100">
            <th class="p-2 border">中文名</th>
            <th class="p-2 border">英文名</th>
            <th class="p-2 border">港口代码</th>
            <th class="p-2 border">别名（逗号分隔）</th>
            <th class="p-2 border">操作</th>
          </tr>
        </thead>
        <tbody id="dest-ports-table"></tbody>
      </table>
      <div class="text-xs text-gray-600">CSV表头支持：cn,en,code,aliases 或 中文名,英文名,港口代码,别名</div>
    </section>

    <!-- 6~9. 首页模块配置：获客中心 / 实用工具 / 积分商城 / 集卡博物馆 -->
    <section class="bg-white rounded-lg shadow p-6 border border-gray-200 mb-6">
      <h2 class="text-xl font-semibold mb-3 flex items-center"><i class="fas fa-layer-group text-gray-700 mr-2"></i>首页模块配置</h2>
      <div class="rounded bg-blue-50 border border-blue-200 p-3 text-sm text-blue-700 mb-4">
        说明：直接修改首页模块的标题、入口按钮文案与链接，以及“获客中心”四项的名称/描述/链接。保存后会写入浏览器配置并即时生效。
      </div>
      <form id="home-config-form" class="space-y-6">
        <section class="border rounded-lg p-4">
          <h3 class="text-lg font-semibold mb-3 flex items-center"><i class="fas fa-toolbox text-blue-600 mr-2"></i>实用工具模块</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm text-gray-600 mb-1">模块标题</label>
              <input id="tools-title" type="text" class="w-full border rounded px-3 py-2" placeholder="实用工具">
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">入口按钮文案</label>
              <input id="tools-enter-text" type="text" class="w-full border rounded px-3 py-2" placeholder="进入实用工具">
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">入口按钮链接</label>
              <input id="tools-enter-link" type="text" class="w-full border rounded px-3 py-2" placeholder="pages/tools/index.html">
            </div>
          </div>
          <div class="mt-4 border-t pt-4">
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm font-semibold">工具条目（名称、链接、下载、介绍、图片）</div>
              <button type="button" id="tools-clear" class="btn-secondary text-xs"><i class="fas fa-trash mr-2"></i>清空列表</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
              <div>
                <label class="block text-xs text-gray-600 mb-1">名称</label>
                <input id="new-tool-name" type="text" class="w-full border rounded px-3 py-2" placeholder="如：运价查询">
              </div>
              <div>
                <label class="block text-xs text-gray-600 mb-1">访问链接</label>
                <input id="new-tool-link" type="text" class="w-full border rounded px-3 py-2" placeholder="如：pages/tools/freight-query.html">
              </div>
              <div>
                <label class="block text-xs text-gray-600 mb-1">下载链接（可选）</label>
                <input id="new-tool-download" type="text" class="w-full border rounded px-3 py-2" placeholder="如：/downloads/tool.zip">
              </div>
              <div>
                <label class="block text-xs text-gray-600 mb-1">图片地址（可选）</label>
                <input id="new-tool-image" type="text" class="w-full border rounded px-3 py-2" placeholder="图片URL 或留空">
              </div>
              <div>
                <label class="block text-xs text-gray-600 mb-1">上传图片（可选）</label>
                <input id="new-tool-file" type="file" accept="image/*" class="w-full border rounded px-3 py-2">
              </div>
              <div class="md:col-span-2">
                <label class="block text-xs text-gray-600 mb-1">介绍文章</label>
                <textarea id="new-tool-content" class="w-full border rounded px-3 py-2" rows="3" placeholder="简单介绍、使用说明等"></textarea>
              </div>
            </div>
            <div class="flex gap-3 mb-4">
              <button type="button" id="tools-add" class="btn-primary"><i class="fas fa-plus mr-2"></i>添加工具</button>
              <button type="button" id="tools-save" class="btn-secondary"><i class="fas fa-save mr-2"></i>保存工具列表</button>
            </div>
            <div id="tools-items-list" class="space-y-3"></div>
          </div>
        </section>

        <section class="border rounded-lg p-4">
          <h3 class="text-lg font-semibold mb-3 flex items-center"><i class="fas fa-store text-green-600 mr-2"></i>积分商城模块</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm text-gray-600 mb-1">模块标题</label>
              <input id="mall-title" type="text" class="w-full border rounded px-3 py-2" placeholder="积分商城">
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">入口按钮文案</label>
              <input id="mall-enter-text" type="text" class="w-full border rounded px-3 py-2" placeholder="进入积分商城">
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">入口按钮链接</label>
              <input id="mall-enter-link" type="text" class="w-full border rounded px-3 py-2" placeholder="pages/points-mall/index.html">
            </div>
          </div>
        </section>

        <section class="border rounded-lg p-4">
          <h3 class="text-lg font-semibold mb-3 flex items-center"><i class="fas fa-truck-moving text-orange-500 mr-2"></i>集卡博物馆模块</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm text-gray-600 mb-1">模块标题</label>
              <input id="museum-title" type="text" class="w-full border rounded px-3 py-2" placeholder="集卡博物馆">
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">入口按钮文案</label>
              <input id="museum-enter-text" type="text" class="w-full border rounded px-3 py-2" placeholder="进入集卡博物馆">
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">入口按钮链接</label>
              <input id="museum-enter-link" type="text" class="w-full border rounded px-3 py-2" placeholder="pages/jika-museum/index.html">
            </div>
          </div>
        </section>

        <section class="border rounded-lg p-4">
          <h3 class="text-lg font-semibold mb-3 flex items-center"><i class="fas fa-user-friends text-violet-600 mr-2"></i>获客中心模块</h3>
          <div class="mb-3">
            <label class="block text-sm text-gray-600 mb-1">模块标题</label>
            <input id="leads-title" type="text" class="w-full border rounded px-3 py-2" placeholder="获客中心">
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="border rounded p-3">
              <div class="text-sm font-semibold mb-2">入口1</div>
              <label class="block text-xs text-gray-600 mb-1">名称</label>
              <input id="leads-item-0-name" type="text" class="w-full border rounded px-3 py-2 mb-2" placeholder="本地货代">
              <label class="block text-xs text-gray-600 mb-1">描述</label>
              <input id="leads-item-0-desc" type="text" class="w-full border rounded px-3 py-2 mb-2" placeholder="对接本地/全国货代伙伴">
              <label class="block text-xs text-gray-600 mb-1">链接</label>
              <input id="leads-item-0-link" type="text" class="w-full border rounded px-3 py-2" placeholder="#">
            </div>
            <div class="border rounded p-3">
              <div class="text-sm font-semibold mb-2">入口2</div>
              <label class="block text-xs text-gray-600 mb-1">名称</label>
              <input id="leads-item-1-name" type="text" class="w-full border rounded px-3 py-2 mb-2" placeholder="海外代理">
              <label class="block text-xs text-gray-600 mb-1">描述</label>
              <input id="leads-item-1-desc" type="text" class="w-full border rounded px-3 py-2 mb-2" placeholder="拓展海外船东与代理网">
              <label class="block text-xs text-gray-600 mb-1">链接</label>
              <input id="leads-item-1-link" type="text" class="w-full border rounded px-3 py-2" placeholder="#">
            </div>
            <div class="border rounded p-3">
              <div class="text-sm font-semibold mb-2">入口3</div>
              <label class="block text-xs text-gray-600 mb-1">名称</label>
              <input id="leads-item-2-name" type="text" class="w-full border rounded px-3 py-2 mb-2" placeholder="国内工厂">
              <label class="block text-xs text-gray-600 mb-1">描述</label>
              <input id="leads-item-2-desc" type="text" class="w-full border rounded px-3 py-2 mb-2" placeholder="链接制造端直客需求">
              <label class="block text-xs text-gray-600 mb-1">链接</label>
              <input id="leads-item-2-link" type="text" class="w-full border rounded px-3 py-2" placeholder="#">
            </div>
            <div class="border rounded p-3">
              <div class="text-sm font-semibold mb-2">入口4</div>
              <label class="block text-xs text-gray-600 mb-1">名称</label>
              <input id="leads-item-3-name" type="text" class="w-full border rounded px-3 py-2 mb-2" placeholder="海外买家">
              <label class="block text-xs text-gray-600 mb-1">描述</label>
              <input id="leads-item-3-desc" type="text" class="w-full border rounded px-3 py-2 mb-2" placeholder="对接进口买家与渠道">
              <label class="block text-xs text-gray-600 mb-1">链接</label>
              <input id="leads-item-3-link" type="text" class="w-full border rounded px-3 py-2" placeholder="#">
            </div>
          </div>
          <div class="flex items-center gap-3 mt-3">
            <button type="button" id="btn-save" class="bg-primary text-white px-4 py-2 rounded"><i class="fas fa-save mr-2"></i>保存</button>
            <button type="button" id="btn-reset" class="bg-gray-200 text-gray-800 px-4 py-2 rounded"><i class="fas fa-undo mr-2"></i>恢复默认</button>
            <button type="button" id="btn-apply" class="bg-blue-100 text-blue-700 px-4 py-2 rounded"><i class="fas fa-sync mr-2"></i>立即应用</button>
          </div>
          <div class="mt-2 text-xs text-gray-500">提示：如首页已打开，请刷新或在同一浏览器内自动同步更改。</div>
        </section>
      </form>
    </section>
    <section class="bg-white rounded-lg shadow p-6 border border-blue-200 mb-6">
      <h2 class="text-xl font-semibold mb-3 flex items-center"><i class="fas fa-file-alt mr-2 text-blue-600"></i>登录页右侧文案配置</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div>
          <label class="block text-sm text-gray-600 mb-1">标题</label>
          <input id="login-side-title-input" type="text" class="w-full border rounded px-3 py-2" placeholder="登录后您可以">
        </div>
        <div>
          <label class="block text-sm text-gray-600 mb-1">按钮文案</label>
          <input id="login-side-cta-text" type="text" class="w-full border rounded px-3 py-2" placeholder="会员升级/开通">
        </div>
        <div>
          <label class="block text-sm text-gray-600 mb-1">按钮链接</label>
          <input id="login-side-cta-href" type="text" class="w-full border rounded px-3 py-2" placeholder="/pages/user/upgrade.html">
        </div>
      </div>
      <div class="border-t pt-4">
        <div class="flex items-center justify-between mb-2">
          <div class="text-sm font-semibold">简介条目</div>
          <div class="flex items-center gap-2">
            <button type="button" id="login-side-bullets-save" class="btn-primary"><i class="fas fa-save mr-2"></i>保存文案</button>
            <button type="button" id="login-side-bullets-clear" class="btn-secondary"><i class="fas fa-trash mr-2"></i>清空条目</button>
          </div>
        </div>
        <div class="flex items-center gap-3 mb-3">
          <input id="login-side-new-bullet" type="text" class="flex-1 border rounded px-3 py-2" placeholder="如：· 查看与管理订单/询价">
          <button type="button" id="login-side-add" class="btn-primary"><i class="fas fa-plus mr-2"></i>添加条目</button>
        </div>
        <div id="login-side-bullets-list" class="space-y-2"></div>
      </div>
    </section>
  </main>
  <div id="footer-container"></div>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      loadComponent('header-container', '/components/header.html');
      loadComponent('footer-container', '/components/footer.html');

      // 权限已在下方立即执行脚本校验

      // 追踪设置：读写
      const tsKey = 'trackingSettings';
      const t = id => document.getElementById(id);
      let toolsItems = [];
      function loadTrackingSettings(){
        const cfg = JSON.parse(localStorage.getItem(tsKey) || '{}');
        t('track-title').value = cfg.title || '';
        t('track-button-text').value = cfg.buttonText || '';
        t('track-placeholder').value = cfg.placeholder || '';
        t('track-link-text').value = cfg.linkText || '';
        t('track-help-link-href').value = cfg.helpLinkHref || '';
        t('track-container-regex').value = cfg.containerRegex || '';
        t('track-bl-regex').value = cfg.blRegex || '';
        t('track-invalid-tip').value = cfg.invalidTip || '';
      }
      function saveTrackingSettings(){
        const data = {
          title: t('track-title').value.trim(),
          buttonText: t('track-button-text').value.trim(),
          placeholder: t('track-placeholder').value.trim(),
          linkText: t('track-link-text').value.trim(),
          helpLinkHref: t('track-help-link-href').value.trim(),
          containerRegex: t('track-container-regex').value.trim(),
          blRegex: t('track-bl-regex').value.trim(),
          invalidTip: t('track-invalid-tip').value.trim()
        };
        if (window.APP_API && window.APP_API.set) {
          window.APP_API.set(tsKey, data).then(function(){ localStorage.setItem('trackingSettingsUpdated', Date.now().toString()); alert('已保存追踪设置'); });
        } else {
          localStorage.setItem(tsKey, JSON.stringify(data));
          localStorage.setItem('trackingSettingsUpdated', Date.now().toString());
          alert('已保存追踪设置');
        }
      }
      t('track-save').addEventListener('click', saveTrackingSettings);
      t('track-reset').addEventListener('click', function(){
        localStorage.removeItem(tsKey);
        localStorage.setItem('trackingSettingsUpdated', Date.now().toString());
        loadTrackingSettings();
        alert('已恢复默认');
      });
      loadTrackingSettings();
      

      // 首页新闻维护
      const newsKey = 'home_news';
      function getNews(){ try { return JSON.parse(localStorage.getItem(newsKey) || '[]'); } catch { return []; } }
      function setNews(arr){ if (window.APP_API && window.APP_API.set) { window.APP_API.set(newsKey, arr); } else { localStorage.setItem(newsKey, JSON.stringify(arr)); } }
      function renderNews(){
        const ul = document.getElementById('news-list');
        ul.innerHTML = '';
        const arr = getNews();
        arr.forEach((n, idx) => {
          const li = document.createElement('li');
          li.className = 'mb-2';
          li.innerHTML = `
            <input class="border rounded px-2 py-1 mr-2 w-48" value="${n.title}" placeholder="标题">
            <input class="border rounded px-2 py-1 mr-2 w-64" value="${n.summary}" placeholder="摘要">
            <input class="border rounded px-2 py-1 mr-2 w-56" value="${n.href}" placeholder="链接">
            <button class="btn-secondary text-xs mr-2" data-act="save" data-idx="${idx}"><i class='fas fa-save mr-1'></i>保存</button>
            <button class="btn-secondary text-xs" data-act="delete" data-idx="${idx}"><i class='fas fa-trash mr-1'></i>删除</button>`;
          ul.appendChild(li);
        });
      }
      document.getElementById('news-add').addEventListener('click', function(){
        const title = t('news-title').value.trim();
        const summary = t('news-summary').value.trim();
        const href = t('news-href').value.trim();
        if (!title) { alert('请填写标题'); return; }
        const arr = getNews();
        arr.push({ title, summary, href });
        setNews(arr);
        renderNews();
        t('news-title').value = '';
        t('news-summary').value = '';
        t('news-href').value = '';
      });
      document.getElementById('news-save').addEventListener('click', function(){
        alert('已保存新闻列表');
      });
      document.getElementById('news-clear').addEventListener('click', function(){
        if (!confirm('确认清空首页新闻列表？')) return;
        setNews([]);
        renderNews();
      });

      function renderToolsItems(){
        const wrap = t('tools-items-list');
        if (!wrap) return;
        wrap.innerHTML = '';
        toolsItems.forEach((item, idx) => {
          const div = document.createElement('div');
          div.className = 'border rounded p-3';
          const imgSrc = item.imageData || item.image || '';
          div.innerHTML = `
            <div class="flex items-start gap-3">
              ${imgSrc ? `<img src="${imgSrc}" alt="cover" class="w-16 h-16 object-cover rounded border">` : `<div class="w-16 h-16 rounded border flex items-center justify-center text-xs text-gray-400">无图</div>`}
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3 flex-1">
                <div>
                  <label class="block text-xs text-gray-600 mb-1">名称</label>
                  <input data-idx="${idx}" data-key="name" class="w-full border rounded px-3 py-2" value="${item.name||''}" placeholder="工具名称">
                </div>
                <div>
                  <label class="block text-xs text-gray-600 mb-1">访问链接</label>
                  <input data-idx="${idx}" data-key="link" class="w-full border rounded px-3 py-2" value="${item.link||''}" placeholder="如：pages/tools/xxx.html">
                </div>
                <div>
                  <label class="block text-xs text-gray-600 mb-1">下载链接</label>
                  <input data-idx="${idx}" data-key="download" class="w-full border rounded px-3 py-2" value="${item.download||''}" placeholder="可选">
                </div>
                <div>
                  <label class="block text-xs text-gray-600 mb-1">图片地址</label>
                  <input data-idx="${idx}" data-key="image" class="w-full border rounded px-3 py-2" value="${item.image||''}" placeholder="可选">
                </div>
                <div class="md:col-span-2">
                  <label class="block text-xs text-gray-600 mb-1">介绍文章</label>
                  <textarea data-idx="${idx}" data-key="content" class="w-full border rounded px-3 py-2" rows="3" placeholder="介绍与说明">${item.content||''}</textarea>
                </div>
              </div>
            </div>
            <div class="flex gap-2 mt-3">
              <button class="btn-secondary text-xs" data-act="save" data-idx="${idx}"><i class='fas fa-save mr-1'></i>保存</button>
              <button class="btn-secondary text-xs" data-act="delete" data-idx="${idx}"><i class='fas fa-trash mr-1'></i>删除</button>
            </div>`;
          wrap.appendChild(div);
        });
      }

      document.getElementById('tools-items-list').addEventListener('click', function(e){
        const act = e.target.closest('button')?.dataset.act;
        const idx = e.target.closest('button')?.dataset.idx;
        if (!act) return;
        const i = Number(idx);
        if (Number.isNaN(i)) return;
        if (act === 'delete') {
          toolsItems.splice(i, 1);
          renderToolsItems();
          return;
        }
        if (act === 'save') {
          const container = this.children[i];
          if (!container) return;
          const inputs = container.querySelectorAll('input[data-key], textarea[data-key]');
          inputs.forEach(inp => {
            const key = inp.getAttribute('data-key');
            toolsItems[i][key] = inp.value.trim();
          });
          alert('已保存该工具条目');
        }
      });

      function readFileAsDataURL(file){
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }

      document.getElementById('tools-add').addEventListener('click', async function(){
        const name = t('new-tool-name').value.trim();
        const link = t('new-tool-link').value.trim();
        const download = t('new-tool-download').value.trim();
        const image = t('new-tool-image').value.trim();
        const file = t('new-tool-file').files?.[0];
        const content = t('new-tool-content').value.trim();
        if (!name) { alert('请填写名称'); return; }
        const item = { name, link, download, image, content };
        if (file) {
          try { item.imageData = await readFileAsDataURL(file); } catch {}
        }
        toolsItems.push(item);
        renderToolsItems();
        t('new-tool-name').value = '';
        t('new-tool-link').value = '';
        t('new-tool-download').value = '';
        t('new-tool-image').value = '';
        t('new-tool-file').value = '';
        t('new-tool-content').value = '';
      });

      document.getElementById('tools-save').addEventListener('click', function(){
        const cfg = collectFormConfig();
        saveHomeConfig(cfg);
      });
      document.getElementById('tools-clear').addEventListener('click', function(){
        if (!confirm('确认清空工具列表？')) return;
        toolsItems = [];
        renderToolsItems();
      });
      document.getElementById('news-list').addEventListener('click', function(e){
        const btn = e.target.closest('button');
        if (!btn) return;
        const act = btn.getAttribute('data-act');
        const idx = parseInt(btn.getAttribute('data-idx'), 10);
        const li = btn.closest('li');
        const inputs = li.querySelectorAll('input');
        const rec = { title: inputs[0].value.trim(), summary: inputs[1].value.trim(), href: inputs[2].value.trim() };
        const arr = getNews();
        if (act === 'save') {
          arr[idx] = rec; setNews(arr); alert('已保存');
        } else if (act === 'delete') {
          arr.splice(idx,1); setNews(arr); renderNews();
        }
      });
      renderNews();

      // —— 资讯文章库维护（扩展字段） ——
      function normalizeNewsItem(it, i){
        return {
          id: it.id || String(i+1),
          title: it.title || '',
          summary: it.summary || '',
          href: it.href || 'pages/news/detail.html',
          cover: it.cover || '',
          publishDate: it.publishDate || '',
          source: it.source || '',
          tags: Array.isArray(it.tags) ? it.tags : (typeof it.tags==='string' && it.tags ? it.tags.split(',').map(s=>s.trim()).filter(Boolean) : []),
          heat: typeof it.heat === 'number' ? it.heat : ((it.title||'').length + (it.summary||'').length),
          pinned: !!it.pinned
        };
      }
      function renderNewsLib(){
        const tbody = document.getElementById('newslib-table'); if (!tbody) return;
        tbody.innerHTML = '';
        const arr = getNews().map((it,i)=>normalizeNewsItem(it,i));
        arr.forEach((n, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="p-2 border align-top">
              <div class="flex items-center gap-2">
                <img src="${n.cover||''}" alt="cover" class="w-12 h-12 object-cover border rounded" onerror="this.style.display='none'">
                <input class="border rounded px-2 py-1 w-48" value="${n.cover||''}" placeholder="封面地址">
              </div>
              <div class="mt-1 text-xs text-gray-600">替换上传：<input type="file" accept="image/*" data-idx="${idx}" class="inline-block"></div>
            </td>
            <td class="p-2 border align-top">
              <input class="border rounded px-2 py-1 w-full mb-1" value="${n.title}" placeholder="标题">
              <input class="border rounded px-2 py-1 w-full" value="${n.summary}" placeholder="摘要">
            </td>
            <td class="p-2 border align-top">
              <input type="datetime-local" class="border rounded px-2 py-1 w-48" value="${n.publishDate}">
              <input class="border rounded px-2 py-1 w-48 mt-1" value="${n.source}" placeholder="来源">
            </td>
            <td class="p-2 border align-top">
              <input class="border rounded px-2 py-1 w-40" value="${(n.tags||[]).join(', ')}" placeholder="标签">
            </td>
            <td class="p-2 border align-top">
              <input type="number" class="border rounded px-2 py-1 w-24" value="${n.heat||0}" placeholder="热度">
            </td>
            <td class="p-2 border align-top">
              <input class="border rounded px-2 py-1 w-56" value="${n.href}" placeholder="链接">
            </td>
            <td class="p-2 border align-top text-center">
              <input type="checkbox" ${n.pinned?'checked':''}>
            </td>
            <td class="p-2 border align-top">
              <button class="btn-secondary text-xs mr-2" data-act="save" data-idx="${idx}"><i class="fas fa-save mr-1"></i>保存</button>
              <button class="btn-secondary text-xs" data-act="delete" data-idx="${idx}"><i class="fas fa-trash mr-1"></i>删除</button>
            </td>`;
          tbody.appendChild(tr);
        });
      }
      function collectNewLibItemFromForm(){
        const title = t('newslib-title').value.trim();
        const summary = t('newslib-summary').value.trim();
        const href = t('newslib-href').value.trim() || 'pages/news/detail.html';
        const cover = t('newslib-cover-url').value.trim();
        const publishDate = t('newslib-publish').value || '';
        const source = t('newslib-source').value.trim();
        const tags = (t('newslib-tags').value||'').split(',').map(s=>s.trim()).filter(Boolean);
        const heat = parseInt(t('newslib-heat').value||'0',10) || 0;
        const pinned = !!t('newslib-pinned').checked;
        return { id: String(Date.now()), title, summary, href, cover, publishDate, source, tags, heat, pinned };
      }
      document.getElementById('newslib-add').addEventListener('click', function(){
        const title = t('newslib-title').value.trim();
        if (!title){ alert('请填写标题'); return; }
        const arr = getNews();
        const file = document.getElementById('newslib-cover-file').files[0];
        function pushItem(finalCover){
          const rec = collectNewLibItemFromForm(); rec.cover = finalCover || rec.cover;
          arr.push(rec); setNews(arr); renderNewsLib();
          ['newslib-title','newslib-summary','newslib-href','newslib-cover-url','newslib-publish','newslib-source','newslib-tags','newslib-heat'].forEach(id=>t(id).value='');
          t('newslib-pinned').checked = false; const f=document.getElementById('newslib-cover-file'); if (f) f.value='';
        }
        if (file){ const reader = new FileReader(); reader.onload = function(){ pushItem(reader.result); }; reader.readAsDataURL(file); }
        else { pushItem(); }
      });
      document.getElementById('newslib-table').addEventListener('click', function(e){
        const btn = e.target.closest('button'); if (!btn) return;
        const act = btn.getAttribute('data-act');
        const idx = parseInt(btn.getAttribute('data-idx'), 10);
        const tr = btn.closest('tr'); const inputs = tr.querySelectorAll('input');
        const cover = inputs[1].value.trim();
        const title = inputs[2].value.trim();
        const summary = inputs[3].value.trim();
        const publishDate = inputs[4].value;
        const source = inputs[5].value.trim();
        const tagsStr = inputs[6].value.trim();
        const heat = parseInt(inputs[7].value||'0',10) || 0;
        const href = inputs[8].value.trim();
        const pinned = inputs[9].checked;
        const arr = getNews(); const old = normalizeNewsItem(arr[idx]||{}, idx);
        const rec = { ...old, cover, title, summary, publishDate, source, tags: tagsStr.split(',').map(s=>s.trim()).filter(Boolean), heat, href, pinned };
        if (act==='save'){ arr[idx] = rec; setNews(arr); alert('已保存'); }
        else if (act==='delete'){ arr.splice(idx,1); setNews(arr); renderNewsLib(); }
      });
      // 替换封面（文件上传）
      document.getElementById('newslib-table').addEventListener('change', function(e){
        const input = e.target; if (input.type !== 'file') return;
        const idx = parseInt(input.getAttribute('data-idx')||'-1', 10);
        const file = input.files[0]; if (!file || idx<0) return;
        const reader = new FileReader(); reader.onload = function(){
          const arr = getNews(); const cur = normalizeNewsItem(arr[idx]||{}, idx);
          arr[idx] = { ...cur, cover: reader.result }; setNews(arr); renderNewsLib(); };
        reader.readAsDataURL(file);
      });
      // 导出/导入/清空
      document.getElementById('newslib-export').addEventListener('click', function(){
        const data = JSON.stringify(getNews(), null, 2);
        const blob = new Blob([data], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'home_news.json'; a.click(); URL.revokeObjectURL(url);
      });
      document.getElementById('newslib-import-file').addEventListener('change', function(){
        const file = this.files[0]; if (!file) return;
        const reader = new FileReader(); reader.onload = function(){
          try {
            const arr = JSON.parse(reader.result.toString());
            if (!Array.isArray(arr)) throw new Error('JSON 内容不是数组');
            setNews(arr); renderNewsLib(); alert('已导入文章库');
          } catch(e){ alert('导入失败：'+e.message); }
        }; reader.readAsText(file, 'utf-8');
      });
      document.getElementById('newslib-clear').addEventListener('click', function(){
        if (!confirm('确认清空文章库（home_news）？')) return;
        setNews([]); renderNewsLib();
      });
      renderNewsLib();

      // ——— 兼容迁移：禁用旧文章库的交互，并引导到新页面 ———
      (function deprecateOldNewsLibrary(){
        const go = function(){
          alert('该功能已迁移至“新闻库管理”新页面，请在新页面进行文章库的新增、编辑、导入导出与清空等操作。');
          location.href = '/pages/admin/news.html#library';
        };
        const addBtn = document.getElementById('newslib-add'); if (addBtn) addBtn.addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); go(); }, { once: false });
        const expBtn = document.getElementById('newslib-export'); if (expBtn) expBtn.addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); go(); }, { once: false });
        const impFile = document.getElementById('newslib-import-file'); if (impFile) impFile.addEventListener('change', function(e){ e.preventDefault(); e.stopPropagation(); go(); }, { once: false });
        const clrBtn = document.getElementById('newslib-clear'); if (clrBtn) clrBtn.addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); go(); }, { once: false });
        const table = document.getElementById('newslib-table'); if (table){
          table.addEventListener('click', function(e){ const btn = e.target.closest('button'); if(!btn) return; e.preventDefault(); e.stopPropagation(); go(); });
          table.addEventListener('change', function(e){ const input = e.target; if (input && input.type==='file'){ e.preventDefault(); e.stopPropagation(); go(); } });
        }
      })();

      // —— 侧边栏配置：作者/嘉宾/标签 ——
      const sideAuthorKey = 'news_side_author';
      const sideGuestsKey = 'news_side_guests';
      const sideTagsKey = 'news_side_tags';
      function getSideAuthor(){ try { return JSON.parse(localStorage.getItem(sideAuthorKey) || 'null'); } catch { return null; } }
      function setSideAuthor(obj){ localStorage.setItem(sideAuthorKey, JSON.stringify(obj||{})); }
      function getSideGuests(){ try { return JSON.parse(localStorage.getItem(sideGuestsKey) || '[]'); } catch { return []; } }
      function setSideGuests(arr){ localStorage.setItem(sideGuestsKey, JSON.stringify(arr||[])); }
      function getSideTags(){ try { return JSON.parse(localStorage.getItem(sideTagsKey) || '[]'); } catch { return []; } }
      function setSideTags(arr){ localStorage.setItem(sideTagsKey, JSON.stringify(arr||[])); }
      function renderSideConfigs(){
        const a = getSideAuthor() || { avatar: '/assets/images/logo.webp', name: 'AI智货代编辑部', bio: '聚焦航运与货代行业趋势与干货分享。' };
        t('side-author-name').value = a.name || '';
        t('side-author-bio').value = a.bio || '';
        t('side-author-avatar-url').value = a.avatar || '';
        const tags = getSideTags(); t('side-tags-list').textContent = tags.join(', ');
        const tbody = document.getElementById('side-guests-table'); tbody.innerHTML='';
        (getSideGuests()||[]).forEach((g, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="p-2 border">
              <div class="flex items-center gap-2">
                <img src="${g.avatar||''}" class="w-10 h-10 rounded-full object-cover border" onerror="this.style.display='none'">
                <input class="border rounded px-2 py-1 w-40" value="${g.avatar||''}" placeholder="头像地址">
              </div>
              <div class="mt-1 text-xs">替换上传：<input type="file" accept="image/*" data-idx="${idx}" class="inline-block"></div>
            </td>
            <td class="p-2 border">
              <input class="border rounded px-2 py-1 w-40 mb-1" value="${g.name||''}" placeholder="名称">
              <input class="border rounded px-2 py-1 w-64" value="${g.intro||''}" placeholder="介绍">
            </td>
            <td class="p-2 border">
              <button class="btn-secondary text-xs mr-2" data-act="save" data-idx="${idx}"><i class="fas fa-save mr-1"></i>保存</button>
              <button class="btn-secondary text-xs" data-act="delete" data-idx="${idx}"><i class="fas fa-trash mr-1"></i>删除</button>
            </td>`;
          tbody.appendChild(tr);
        });
      }
      // 作者保存与头像上传
      document.getElementById('side-author-save').addEventListener('click', function(){
        const obj = { name: t('side-author-name').value.trim(), bio: t('side-author-bio').value.trim(), avatar: t('side-author-avatar-url').value.trim() };
        setSideAuthor(obj); alert('已保存作者信息');
      });
      document.getElementById('side-author-avatar-file').addEventListener('change', function(){
        const file = this.files[0]; if (!file) return;
        const reader = new FileReader(); reader.onload = function(){ t('side-author-avatar-url').value = reader.result; }; reader.readAsDataURL(file);
      });
      // 嘉宾增删改与头像上传
      document.getElementById('side-guest-add').addEventListener('click', function(){
        const name = t('side-guest-name').value.trim(); const intro = t('side-guest-intro').value.trim(); const url = t('side-guest-avatar-url').value.trim(); const file = document.getElementById('side-guest-avatar-file').files[0];
        if (!name){ alert('请填写嘉宾名称'); return; }
        function push(finalAvatar){ const arr = getSideGuests(); arr.push({ name, intro, avatar: finalAvatar || url }); setSideGuests(arr); renderSideConfigs(); t('side-guest-name').value=''; t('side-guest-intro').value=''; t('side-guest-avatar-url').value=''; const f=document.getElementById('side-guest-avatar-file'); if (f) f.value=''; }
        if (file){ const reader=new FileReader(); reader.onload=function(){ push(reader.result); }; reader.readAsDataURL(file); } else { push(); }
      });
      document.getElementById('side-guests-clear').addEventListener('click', function(){ if (!confirm('确认清空嘉宾列表？')) return; setSideGuests([]); renderSideConfigs(); });
      document.getElementById('side-guests-table').addEventListener('click', function(e){
        const btn = e.target.closest('button'); if (!btn) return; const act = btn.getAttribute('data-act'); const idx = parseInt(btn.getAttribute('data-idx'),10);
        const tr = btn.closest('tr'); const inputs = tr.querySelectorAll('input'); const rec = { avatar: inputs[0].value.trim(), name: inputs[1].value.trim(), intro: inputs[2].value.trim() };
        const arr = getSideGuests(); if (act==='save'){ arr[idx]=rec; setSideGuests(arr); alert('已保存'); } else if (act==='delete'){ arr.splice(idx,1); setSideGuests(arr); renderSideConfigs(); }
      });
      document.getElementById('side-guests-table').addEventListener('change', function(e){ const input=e.target; if (input.type!=='file') return; const idx=parseInt(input.getAttribute('data-idx')||'-1',10); const file=input.files[0]; if (!file||idx<0) return; const reader=new FileReader(); reader.onload=function(){ const arr=getSideGuests(); const cur=arr[idx]||{}; arr[idx]={...cur, avatar: reader.result}; setSideGuests(arr); renderSideConfigs(); }; reader.readAsDataURL(file); });
      // 标签保存
      document.getElementById('side-tags-save').addEventListener('click', function(){ const list=(t('side-tags-input').value||'').split(',').map(s=>s.trim()).filter(Boolean); setSideTags(list); renderSideConfigs(); alert('已保存标签'); });
      renderSideConfigs();

      // Hero 配置（与 pages/admin/site.html 使用同一 localStorage 键）
      const heroKey = 'home_hero_config';
      function loadHero(){
        const cfg = JSON.parse(localStorage.getItem(heroKey) || '{}');
        t('hero-bg').value = cfg.background || '';
        t('hero-title').value = cfg.title || '';
        t('hero-subtitle').value = cfg.subtitle || '';
        t('hero-btn1-text').value = (cfg.buttons&&cfg.buttons[0]&&cfg.buttons[0].text) || '';
        t('hero-btn1-link').value = (cfg.buttons&&cfg.buttons[0]&&cfg.buttons[0].link) || '';
        t('hero-btn2-text').value = (cfg.buttons&&cfg.buttons[1]&&cfg.buttons[1].text) || '';
        t('hero-btn2-link').value = (cfg.buttons&&cfg.buttons[1]&&cfg.buttons[1].link) || '';
      }
      function saveHero(){
        const cfg = {
          background: t('hero-bg').value.trim(),
          title: t('hero-title').value.trim(),
          subtitle: t('hero-subtitle').value.trim(),
          buttons: [
            { text: t('hero-btn1-text').value.trim(), link: t('hero-btn1-link').value.trim() },
            { text: t('hero-btn2-text').value.trim(), link: t('hero-btn2-link').value.trim() }
          ]
        };
        localStorage.setItem(heroKey, JSON.stringify(cfg));
        localStorage.setItem('home_hero_config_updated', Date.now().toString());
        alert('已保存横幅配置');
      }
      t('hero-save').addEventListener('click', saveHero);
      t('hero-reset').addEventListener('click', function(){
        localStorage.removeItem(heroKey);
        localStorage.setItem('home_hero_config_updated', Date.now().toString());
        loadHero();
        alert('已恢复默认');
      });
      loadHero();

      // 首页船东卡片维护
      const homeOwnersKey = 'home_shipowners_cards';
      function getHomeOwners(){ try { return JSON.parse(localStorage.getItem(homeOwnersKey) || '[]'); } catch { return []; } }
      function setHomeOwners(arr){ if (window.APP_API && window.APP_API.set) { window.APP_API.set(homeOwnersKey, arr); } else { localStorage.setItem(homeOwnersKey, JSON.stringify(arr)); } }
      function syncHomeOwnersFromStatic(){
        const staticOwners = [
          { name: '地中海航运', logo: '/assets/images/1msc.webp', link: '' },
          { name: '马士基', logo: '/assets/images/2msk.webp', link: '' },
          { name: '达飞轮船', logo: '/assets/images/3cma.webp', link: '' },
          { name: '中远海运', logo: '/assets/images/4cosco.webp', link: '' },
          { name: '赫伯罗特', logo: '/assets/images/5hpl.webp', link: '' },
          { name: '海洋网联', logo: '/assets/images/6one.webp', link: '' },
          { name: '长荣海运', logo: '/assets/images/7emc.webp', link: '' },
          { name: '现代商船', logo: '/assets/images/8hmm.webp', link: '' },
          { name: '以星航运', logo: '/assets/images/9zim.webp', link: '' },
          { name: '阳明海运', logo: '/assets/images/10ym.webp', link: '' },
          { name: '东方海外', logo: '/assets/images/11oocl.webp', link: '' },
          { name: '太平船务', logo: '/assets/images/12pil.webp', link: '' },
          { name: '万海航运', logo: '/assets/images/13wanhai.webp', link: '' },
          { name: '高丽海运', logo: '/assets/images/14kmtc.webp', link: '' },
          { name: '海丰国际', logo: '/assets/images/15sitc.webp', link: '' },
          { name: '德翔海运', logo: '/assets/images/16tsl.webp', link: '' },
          { name: '宏海船务', logo: '/assets/images/17rcl.webp', link: '' },
          { name: '长锦商船', logo: '/assets/images/18smline.webp', link: '' },
          { name: '天敬海运', logo: '/assets/images/19ckline.webp', link: '' },
          { name: '南星船务', logo: '/assets/images/20namsung.webp', link: '' }
        ];
        setHomeOwners(staticOwners);
        localStorage.setItem('home_shipowners_cards_updated', Date.now().toString());
        renderHomeOwners();
        alert('已从首页静态列表同步到后台（名称与Logo）。如需外部追踪链接，请在“链接”列补充或使用船东列表维护设置模板。');
      }
      function renderHomeOwners(){
        const tbody = document.getElementById('home-owner-table');
        tbody.innerHTML = '';
        getHomeOwners().forEach((o, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="p-2 border"><input class="border rounded px-2 py-1 w-full" value="${o.name}"></td>
            <td class="p-2 border">
              <div class="flex items-center gap-2">
                <img src="${o.logo||''}" alt="logo" class="w-10 h-10 object-contain border rounded" onerror="this.style.display='none'">
                <input class="border rounded px-2 py-1 w-full" placeholder="Logo地址" value="${o.logo||''}">
              </div>
              <div class="mt-1 text-xs text-gray-600">或上传：<input type="file" accept="image/*" data-idx="${idx}" class="inline-block"></div>
            </td>
            <td class="p-2 border"><input class="border rounded px-2 py-1 w-full" value="${o.link}"></td>
            <td class="p-2 border">
              <button class="btn-secondary text-xs mr-2" data-act="save" data-idx="${idx}"><i class="fas fa-save mr-1"></i>保存</button>
              <button class="btn-secondary text-xs" data-act="delete" data-idx="${idx}"><i class="fas fa-trash mr-1"></i>删除</button>
            </td>`;
          tbody.appendChild(tr);
        });
      }
      document.getElementById('home-owner-add').addEventListener('click', function(){
        const name = t('home-owner-name').value.trim();
        const logo = t('home-owner-logo').value.trim();
        const link = t('home-owner-link').value.trim();
        const file = document.getElementById('home-owner-logo-file').files[0];
        if (!name){ alert('请填写名称'); return; }
        const arr = getHomeOwners();
        function pushAndRender(finalLogo){
          arr.push({ name, logo: finalLogo || logo, link });
          setHomeOwners(arr); renderHomeOwners();
          t('home-owner-name').value = ''; t('home-owner-logo').value = ''; t('home-owner-link').value = '';
          const f = document.getElementById('home-owner-logo-file'); if (f) f.value='';
        }
        if (file) {
          const reader = new FileReader();
          reader.onload = function(){ pushAndRender(reader.result); };
          reader.readAsDataURL(file);
        } else {
          pushAndRender();
        }
      });
      document.getElementById('home-owner-clear').addEventListener('click', function(){
        if (!confirm('确认清空首页船东卡片？')) return;
        setHomeOwners([]); renderHomeOwners();
      });
      document.getElementById('home-owner-table').addEventListener('click', function(e){
        const btn = e.target.closest('button'); if (!btn) return;
        const act = btn.getAttribute('data-act');
        const idx = parseInt(btn.getAttribute('data-idx'), 10);
        const tr = btn.closest('tr'); const inputs = tr.querySelectorAll('input');
        const rec = { name: inputs[0].value.trim(), logo: inputs[1].value.trim(), link: inputs[2].value.trim() };
        const arr = getHomeOwners();
        if (act === 'save'){ arr[idx] = rec; setHomeOwners(arr); alert('已保存'); }
        else if (act === 'delete'){ arr.splice(idx,1); setHomeOwners(arr); renderHomeOwners(); }
      });
      // 一键同步首页静态列表
      document.getElementById('home-owner-sync-static').addEventListener('click', syncHomeOwnersFromStatic);
      // 替换Logo（文件上传）
      document.getElementById('home-owner-table').addEventListener('change', function(e){
        const input = e.target;
        if (input.type !== 'file') return;
        const idx = parseInt(input.getAttribute('data-idx')||'-1', 10);
        const file = input.files[0];
        if (!file || idx<0) return;
        const reader = new FileReader();
        reader.onload = function(){
          const arr = getHomeOwners();
          const rec = arr[idx];
          arr[idx] = { ...rec, logo: reader.result };
          setHomeOwners(arr); renderHomeOwners();
        };
        reader.readAsDataURL(file);
      });
      // 批量导入（CSV：名称, 链接, 图片）
      function parseCSV(text){
        const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
        const rows = lines.map(line => {
          const parts = [];
          let current = '';
          let inQuotes = false;
          for (let i = 0; i < line.length; i++){
            const ch = line[i];
            if (ch === '"'){
              if (inQuotes && line[i+1] === '"'){ current += '"'; i++; }
              else { inQuotes = !inQuotes; }
            } else if (ch === ',' && !inQuotes){ parts.push(current.trim()); current = ''; }
            else { current += ch; }
          }
          parts.push(current.trim());
          return parts;
        });
        // 跳过可能的表头
        const header = rows[0] || [];
        const looksHeader = header.join(',').toLowerCase().includes('名称') || header.join(',').toLowerCase().includes('name');
        const dataRows = looksHeader ? rows.slice(1) : rows;
        return dataRows.map(cols => ({
          name: (cols[0]||'').trim(),
          link: (cols[1]||'').trim(),
          logo: (cols[2]||'').trim()
        })).filter(r => r.name);
      }
      // 从项目TXT加载：数据/船东名称 .txt
      function parseHomeOwnersTXT(text){
        const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
        const items = [];
        lines.forEach(line => {
          const urlMatch = line.match(/https?:\/\/\S+/);
          const link = urlMatch ? urlMatch[0] : '';
          const name = link ? line.replace(link, '').trim().replace(/[，,]$/,'').trim() : line;
          if (!name) return;
          items.push({ name, link, logo: '' });
        });
        // 去重：按名称唯一
        const uniq = [];
        items.forEach(it => { if (!uniq.find(u => u.name===it.name)) uniq.push(it); });
        return uniq;
      }
      document.getElementById('home-owner-bulk-file').addEventListener('change', function(){
        const file = this.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = function(){
          const text = reader.result.toString();
          const items = parseCSV(text);
          if (!items.length){ alert('CSV未解析到有效行'); return; }
          const arr = getHomeOwners(); items.forEach(it => arr.push(it));
          setHomeOwners(arr); renderHomeOwners();
        };
        reader.readAsText(file, 'utf-8');
      });
      // 处理“从项目TXT加载”
      const btnHomeOwnerTxt = document.getElementById('home-owner-load-txt');
      if (btnHomeOwnerTxt) btnHomeOwnerTxt.addEventListener('click', async function(){
        try {
          const path = '/数据/船东名称 .txt';
          const url = encodeURI(path);
          const res = await fetch(url);
          if (!res.ok){ alert('无法加载项目TXT：'+path); return; }
          const text = await res.text();
          const items = parseHomeOwnersTXT(text);
          if (!items.length){ alert('TXT未解析到有效行'); return; }
          const arr = getHomeOwners(); items.forEach(it => arr.push(it));
          setHomeOwners(arr); localStorage.setItem('home_shipowners_cards_updated', Date.now().toString()); renderHomeOwners();
          alert(`已从项目TXT导入 ${items.length} 条首页船东卡片`);
        } catch(e){ alert('加载失败：'+ e.message); }
      });
      renderHomeOwners();

      // 运价查询：端口库与跳转链接
      const portsKey = 'ports_db';
      const freightLinkKey = 'freight_query_link';
      function getPorts(){ try { return JSON.parse(localStorage.getItem(portsKey) || '[]'); } catch { return []; } }
      function setPorts(arr){ if (window.APP_API && window.APP_API.set) { window.APP_API.set(portsKey, arr); } else { localStorage.setItem(portsKey, JSON.stringify(arr)); } }
      function renderPorts(){
        const tbody = document.getElementById('ports-table');
        tbody.innerHTML = '';
        getPorts().forEach((p, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class=\"p-2 border\"><input class=\"border rounded px-2 py-1 w-full\" value=\"${p.origin||''}\"></td>
            <td class=\"p-2 border\"><input class=\"border rounded px-2 py-1 w-full\" value=\"${p.destination||''}\"></td>
            <td class=\"p-2 border\"><input class=\"border rounded px-2 py-1 w-full\" value=\"${p.code||''}\"></td>
            <td class=\"p-2 border\">
              <button class=\"btn-secondary text-xs mr-2\" data-act=\"save\" data-idx=\"${idx}\"><i class=\"fas fa-save mr-1\"></i>保存</button>
              <button class=\"btn-secondary text-xs\" data-act=\"delete\" data-idx=\"${idx}\"><i class=\"fas fa-trash mr-1\"></i>删除</button>
            </td>`;
          tbody.appendChild(tr);
        });
        // 渲染跳转链接输入框当前值
        t('freight-link').value = localStorage.getItem(freightLinkKey) || '/pages/pricing/index.html';
      }
      document.getElementById('port-clear').addEventListener('click', function(){
        if (!confirm('确认清空端口数据库？')) return; setPorts([]); renderPorts();
      });
      document.getElementById('ports-table').addEventListener('click', function(e){
        const btn = e.target.closest('button'); if (!btn) return;
        const act = btn.getAttribute('data-act'); const idx = parseInt(btn.getAttribute('data-idx'), 10);
        const tr = btn.closest('tr'); const inputs = tr.querySelectorAll('input');
        const rec = { origin: inputs[0].value.trim(), destination: inputs[1].value.trim(), code: inputs[2].value.trim().toUpperCase() };
        const arr = getPorts();
        if (act==='save'){ arr[idx]=rec; setPorts(arr); alert('已保存'); }
        else if (act==='delete'){ arr.splice(idx,1); setPorts(arr); renderPorts(); }
      });
      document.getElementById('ports-csv-file').addEventListener('change', function(){
        const file = this.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = function(){
          const text = reader.result.toString();
          const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
          const rows = lines.map(line => line.split(',').map(s=>s.replace(/^\"|\"$/g,'').trim()));
          // 跳过表头
          const header = (rows[0]||[]).map(s=>s.toLowerCase());
          const isHeader = header.includes('起运港') || header.includes('origin');
          const dataRows = isHeader ? rows.slice(1) : rows;
          const items = dataRows.map(cols => ({ origin: cols[0]||'', destination: cols[1]||'', code: (cols[2]||'').toUpperCase() })).filter(r=>r.origin||r.destination||r.code);
          if (!items.length){ alert('CSV未解析到有效行'); return; }
          const arr = getPorts(); items.forEach(it => arr.push(it)); setPorts(arr); renderPorts();
        };
        reader.readAsText(file, 'utf-8');
      });
      document.getElementById('freight-link').addEventListener('change', function(){
        localStorage.setItem(freightLinkKey, t('freight-link').value.trim());
      });
      renderPorts();

      // 起运港/目的港独立库管理
      const originPortsKey = 'origin_ports_db';
      const destPortsKey = 'destination_ports_db';
      function getOriginPorts(){ try { return JSON.parse(localStorage.getItem(originPortsKey)||'[]'); } catch { return []; } }
      function setOriginPorts(arr){ localStorage.setItem(originPortsKey, JSON.stringify(arr)); }
      function getDestPorts(){ try { return JSON.parse(localStorage.getItem(destPortsKey)||'[]'); } catch { return []; } }
      function setDestPorts(arr){ localStorage.setItem(destPortsKey, JSON.stringify(arr)); }

      function renderOrigin(){
        const tbody = document.getElementById('origin-ports-table'); if (!tbody) return;
        tbody.innerHTML = '';
        getOriginPorts().forEach((p, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="p-2 border"><input class="border rounded px-2 py-1 w-full" value="${p.cn||''}"></td>
            <td class="p-2 border"><input class="border rounded px-2 py-1 w-full" value="${p.en||''}"></td>
            <td class="p-2 border"><input class="border rounded px-2 py-1 w-full" value="${p.code||''}"></td>
            <td class="p-2 border"><input class="border rounded px-2 py-1 w-full" value="${(p.aliases||[]).join(',')}"></td>
            <td class="p-2 border">
              <button class="btn-secondary text-xs mr-2" data-act="save" data-idx="${idx}"><i class="fas fa-save mr-1"></i>保存</button>
              <button class="btn-secondary text-xs" data-act="delete" data-idx="${idx}"><i class="fas fa-trash mr-1"></i>删除</button>
            </td>`;
          tbody.appendChild(tr);
        });
      }
      function renderDest(){
        const tbody = document.getElementById('dest-ports-table'); if (!tbody) return;
        tbody.innerHTML = '';
        getDestPorts().forEach((p, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="p-2 border"><input class="border rounded px-2 py-1 w-full" value="${p.cn||''}"></td>
            <td class="p-2 border"><input class="border rounded px-2 py-1 w-full" value="${p.en||''}"></td>
            <td class="p-2 border"><input class="border rounded px-2 py-1 w-full" value="${p.code||''}"></td>
            <td class="p-2 border"><input class="border rounded px-2 py-1 w-full" value="${(p.aliases||[]).join(',')}"></td>
            <td class="p-2 border">
              <button class="btn-secondary text-xs mr-2" data-act="save" data-idx="${idx}"><i class="fas fa-save mr-1"></i>保存</button>
              <button class="btn-secondary text-xs" data-act="delete" data-idx="${idx}"><i class="fas fa-trash mr-1"></i>删除</button>
            </td>`;
          tbody.appendChild(tr);
        });
      }

      // 起运港事件
      document.getElementById('origin-port-clear').addEventListener('click', function(){ if (!confirm('确认清空起运港库？')) return; setOriginPorts([]); renderOrigin(); });
      document.getElementById('origin-port-add').addEventListener('click', function(){ const arr = getOriginPorts(); arr.push({ cn:'', en:'', code:'', aliases:[] }); setOriginPorts(arr); renderOrigin(); });
      document.getElementById('origin-ports-table').addEventListener('click', function(e){
        const btn = e.target.closest('button'); if (!btn) return;
        const act = btn.getAttribute('data-act'); const idx = parseInt(btn.getAttribute('data-idx'), 10);
        const tr = btn.closest('tr'); const inputs = tr.querySelectorAll('input');
        const rec = { cn: inputs[0].value.trim(), en: inputs[1].value.trim(), code: inputs[2].value.trim().toUpperCase(), aliases: (inputs[3].value||'').split(',').map(s=>s.trim()).filter(Boolean) };
        const arr = getOriginPorts();
        if (act==='save'){ arr[idx]=rec; setOriginPorts(arr); alert('已保存'); }
        else if (act==='delete'){ arr.splice(idx,1); setOriginPorts(arr); renderOrigin(); }
      });
      document.getElementById('origin-ports-csv-file').addEventListener('change', function(){
        const file = this.files[0]; if (!file) return; const reader = new FileReader();
        reader.onload = function(){
          const text = reader.result.toString(); const items = parsePortCSV(text);
          if (!items.length){ alert('CSV未解析到有效行'); return; }
          const arr = getOriginPorts(); items.forEach(it => arr.push(it)); setOriginPorts(arr); renderOrigin();
        }; reader.readAsText(file, 'utf-8');
      });

      // UN/LOCODE 映射辅助：名称标准化与主库索引
      function normalizeName(s){
        if (!s) return '';
        const t = s.toString().trim();
        // 英文：去除空格与常见符号，统一小写；中文：保留原文仅去空白
        const isAscii = /^[\x00-\x7F]*$/.test(t);
        if (isAscii){
          return t.toLowerCase().replace(/[\s\-_.()\[\]{}'"·・/\\]/g,'');
        }
        return t; // 中文精确匹配（去空白已在上面做）
      }
      function buildMasterIndex(master){
        const enMap = new Map(); const cnMap = new Map(); const aliasMap = new Map();
        master.forEach(m => {
          const enKey = normalizeName(m.en);
          const cnKey = normalizeName(m.cn);
          if (enKey) enMap.set(enKey, m);
          if (cnKey) cnMap.set(cnKey, m);
          (m.aliases||[]).forEach(a => { const k = normalizeName(a); if (k && !aliasMap.has(k)) aliasMap.set(k, m); });
        });
        return { enMap, cnMap, aliasMap };
      }
      async function loadMasterPorts(paths){
        const all = [];
        for (const p of paths){
          const url = encodeURI(p);
          const res = await fetch(url);
          if (!res.ok) throw new Error('无法加载模板CSV：'+p);
          const text = await res.text();
          const items = parsePortCSV(text);
          items.forEach(it => all.push(it));
        }
        // 去重：优先以code，其次以(en,cn)组合
        const seen = new Set(); const out = [];
        all.forEach(it => {
          const key = (it.code||'') + '|' + normalizeName(it.en) + '|' + normalizeName(it.cn);
          if (seen.has(key)) return; seen.add(key); out.push(it);
        });
        return out;
      }
      function mapListWithMaster(list, index){
        let mapped = 0, skipped = 0;
        const out = list.map(p => {
          const hasCode = !!(p.code && p.code.trim());
          const enKey = normalizeName(p.en);
          const cnKey = normalizeName(p.cn);
          let match = null;
          if (enKey && index.enMap.has(enKey)) match = index.enMap.get(enKey);
          else if (cnKey && index.cnMap.has(cnKey)) match = index.cnMap.get(cnKey);
          else {
            // 尝试别名匹配（英文或中文输入作为别名）
            if (enKey && index.aliasMap.has(enKey)) match = index.aliasMap.get(enKey);
            else if (cnKey && index.aliasMap.has(cnKey)) match = index.aliasMap.get(cnKey);
          }
          if (match && match.code){
            const newRec = {
              cn: p.cn || match.cn || '',
              en: p.en || match.en || '',
              code: (p.code || match.code || '').toUpperCase(),
              aliases: Array.isArray(p.aliases) ? p.aliases : []
            };
            // 如果原记录没有code，填入；如果有但不同，为避免误覆盖，仅在别名或同名的情况下更新为模板code
            if (!hasCode){ newRec.code = (match.code||'').toUpperCase(); mapped++; return newRec; }
            // 已有code，保持；但如果同名且code为空（理论不可能），也填充。
            skipped++; return newRec;
          }
          skipped++; return p;
        });
        return { out, mapped, skipped };
      }
      async function doOriginMap(){
        try {
          const master = await loadMasterPorts(['/data/ports/origin_ports_template.csv','/data/ports/origin_ports_sample.csv']);
          const index = buildMasterIndex(master);
          const curr = getOriginPorts();
          const { out, mapped, skipped } = mapListWithMaster(curr, index);
          setOriginPorts(out); renderOrigin();
          alert(`起运港映射完成：成功填码 ${mapped} 条，未变更 ${skipped} 条`);
        } catch(e){ alert('起运港映射失败：'+ e.message); }
      }
      async function doDestMap(){
        try {
          const master = await loadMasterPorts(['/data/ports/destination_ports_template.csv','/data/ports/destination_ports_sample.csv']);
          const index = buildMasterIndex(master);
          const curr = getDestPorts();
          const { out, mapped, skipped } = mapListWithMaster(curr, index);
          setDestPorts(out); renderDest();
          alert(`目的港映射完成：成功填码 ${mapped} 条，未变更 ${skipped} 条`);
        } catch(e){ alert('目的港映射失败：'+ e.message); }
      }
      const btnOriginMap = document.getElementById('origin-port-map'); if (btnOriginMap) btnOriginMap.addEventListener('click', doOriginMap);
      const btnDestMap = document.getElementById('dest-port-map'); if (btnDestMap) btnDestMap.addEventListener('click', doDestMap);

      // 从项目TXT加载 起运港：/数据/起运港.txt
      function parseOriginTXT(text){
        const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
        const items = [];
        lines.forEach(line => {
          const parts = line.split(/\s*-\s*/);
          const left = (parts[0]||'').trim();
          const right = (parts[1]||'').trim();
          const lp = left.split('・');
          const ep = right.split('・');
          const en = (lp[0]||'').trim();
          const cnRaw = (ep[0]||'').trim();
          const cn = cnRaw.split('/')[0].trim(); // 去掉可能的“中文 / 国家”中的国家部分
          if (!cn && !en) return;
          items.push({ cn, en, code:'', aliases:[] });
        });
        return items;
      }
      const btnOriginTxt = document.getElementById('origin-ports-load-txt');
      if (btnOriginTxt) btnOriginTxt.addEventListener('click', async function(){
        try {
          const path = '/数据/起运港.txt';
          const url = encodeURI(path);
          const res = await fetch(url);
          if (!res.ok){ alert('无法加载项目TXT：'+path); return; }
          const text = await res.text();
          const items = parseOriginTXT(text);
          if (!items.length){ alert('TXT未解析到有效行'); return; }
          const arr = getOriginPorts(); items.forEach(it => arr.push(it)); setOriginPorts(arr); renderOrigin();
          alert(`已从项目TXT导入 ${items.length} 条起运港`);
        } catch(e){ alert('加载失败：'+ e.message); }
      });

      // 目的港事件
      document.getElementById('dest-port-clear').addEventListener('click', function(){ if (!confirm('确认清空目的港库？')) return; setDestPorts([]); renderDest(); });
      document.getElementById('dest-port-add').addEventListener('click', function(){ const arr = getDestPorts(); arr.push({ cn:'', en:'', code:'', aliases:[] }); setDestPorts(arr); renderDest(); });
      document.getElementById('dest-ports-table').addEventListener('click', function(e){
        const btn = e.target.closest('button'); if (!btn) return;
        const act = btn.getAttribute('data-act'); const idx = parseInt(btn.getAttribute('data-idx'), 10);
        const tr = btn.closest('tr'); const inputs = tr.querySelectorAll('input');
        const rec = { cn: inputs[0].value.trim(), en: inputs[1].value.trim(), code: inputs[2].value.trim().toUpperCase(), aliases: (inputs[3].value||'').split(',').map(s=>s.trim()).filter(Boolean) };
        const arr = getDestPorts();
        if (act==='save'){ arr[idx]=rec; setDestPorts(arr); alert('已保存'); }
        else if (act==='delete'){ arr.splice(idx,1); setDestPorts(arr); renderDest(); }
      });
      document.getElementById('dest-ports-csv-file').addEventListener('change', function(){
        const file = this.files[0]; if (!file) return; const reader = new FileReader();
        reader.onload = function(){
          const text = reader.result.toString(); const items = parsePortCSV(text);
          if (!items.length){ alert('CSV未解析到有效行'); return; }
          const arr = getDestPorts(); items.forEach(it => arr.push(it)); setDestPorts(arr); renderDest();
        }; reader.readAsText(file, 'utf-8');
      });

      // 从项目TXT加载 目的港：/数据/目的港.txt
      function parseDestTXT(text){
        const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
        const items = [];
        lines.forEach(line => {
          const parts = line.split(/\s*-\s*/);
          const left = (parts[0]||'').trim();
          const right = (parts[1]||'').trim();
          const lp = left.split('・');
          const ep = right.split('・');
          const en = (lp[0]||'').trim();
          let cnRaw = (ep[0]||'').trim();
          // 目的港示例包含“中文 / 国家”，取斜杠前为中文名
          const cn = cnRaw.split('/')[0].trim();
          if (!cn && !en) return;
          items.push({ cn, en, code:'', aliases:[] });
        });
        return items;
      }
      const btnDestTxt = document.getElementById('dest-ports-load-txt');
      if (btnDestTxt) btnDestTxt.addEventListener('click', async function(){
        try {
          const path = '/数据/目的港.txt';
          const url = encodeURI(path);
          const res = await fetch(url);
          if (!res.ok){ alert('无法加载项目TXT：'+path); return; }
          const text = await res.text();
          const items = parseDestTXT(text);
          if (!items.length){ alert('TXT未解析到有效行'); return; }
          const arr = getDestPorts(); items.forEach(it => arr.push(it)); setDestPorts(arr); renderDest();
          alert(`已从项目TXT导入 ${items.length} 条目的港`);
        } catch(e){ alert('加载失败：'+ e.message); }
      });

      function parsePortCSV(text){
        const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
        const rows = lines.map(line => line.split(',').map(s=>s.replace(/^"|"$/g,'').trim()));
        if (!rows.length) return [];
        const header = (rows[0]||[]).map(s=>s.toLowerCase());
        const isHeader = header.some(h=>['cn','中文名','en','英文名','code','港口代码','aliases','别名'].includes(h));
        const dataRows = isHeader ? rows.slice(1) : rows;
        const map = (names, h)=>{ for (const n of names){ const i = header.indexOf(n); if (i>=0) return h[i]||''; } return ''; };
        return dataRows.map(h => ({
          cn: map(['cn','中文名'], h),
          en: map(['en','英文名'], h),
          code: (map(['code','港口代码'], h)||'').toUpperCase(),
          aliases: (map(['aliases','别名'], h)||'').split(',').map(s=>s.trim()).filter(Boolean)
        })).filter(r=>r.cn||r.en||r.code);
      }

      // 首次渲染
      renderOrigin(); renderDest();

      // 首页运价播报维护
      const freightMarqueeKey = 'freight_marquee';
      (function initFreightMarqueeAdmin(){
        const input = document.getElementById('freight-marquee-input');
        const btnSave = document.getElementById('freight-marquee-save');
        const btnClear = document.getElementById('freight-marquee-clear');
        if (!input || !btnSave || !btnClear) return;
        function loadMarquee(){ input.value = localStorage.getItem(freightMarqueeKey) || ''; }
        btnSave.addEventListener('click', function(){
          const txt = (input.value||'').trim();
          if (window.APP_API && window.APP_API.set) {
            window.APP_API.set(freightMarqueeKey, txt).then(function(){ localStorage.setItem('freight_marquee_updated', Date.now().toString()); alert('已保存运价播报'); });
          } else {
            localStorage.setItem(freightMarqueeKey, txt);
            localStorage.setItem('freight_marquee_updated', Date.now().toString());
            alert('已保存运价播报');
          }
        });
        btnClear.addEventListener('click', function(){
          localStorage.removeItem(freightMarqueeKey);
          localStorage.setItem('freight_marquee_updated', Date.now().toString());
          input.value = '';
          alert('已清空运价播报');
        });
        loadMarquee();
      })();

      // 测试辅助：通过 URL 参数 ?seed=1 注入示例数据，便于验证前台联动
      (function seedTestDataIfRequested(){
        try {
          const params = new URLSearchParams(location.search);
          const needSeed = params.get('seed') === '1' || params.get('seedTest') === '1';
          if (!needSeed) return;
          // 船东卡片示例（同时供首页下拉与跳转使用）
          const demoOwners = [
            { name: 'MSC', link: 'https://www.msc.com/track/{query}', logo: '/assets/images/1msc.webp' },
            { name: 'MAERSK', link: 'https://www.maersk.com/tracking/{query}', logo: '/assets/images/2msk.webp' }
          ];
          setHomeOwners(demoOwners);
          // 端口库示例（起运港,目的港,港口代码）
          const demoPorts = [
            { origin: '上海', destination: '洛杉矶', code: 'CNSHA' },
            { origin: '宁波', destination: '汉堡', code: 'CNNGB' }
          ];
          setPorts(demoPorts);
          // 跳转链接示例
          localStorage.setItem(freightLinkKey, '/pages/pricing/index.html');
          // 运价播报示例
          localStorage.setItem('freight_marquee', '热门航线更新：亚洲→北美、欧洲→东南亚，行情波动，请及时查询最新运价！');
          localStorage.setItem('freight_marquee_updated', Date.now().toString());
          // 资讯文章库示例（home_news）
          const sampleNews = [
            { id: 'n1', title: '班轮联盟调整，亚洲-北美航线运力优化', summary: '主要船公司发布最新航线计划与舱位安排。', href: '/pages/news/detail.html', cover: '/assets/images/8hmm.webp', publishDate: '2025-01-10T09:00', source: '官方公告', tags: ['航线','运价'], heat: 180, pinned: true },
            { id: 'n2', title: '欧洲港口拥堵缓解，平均等待时长下降', summary: '鹿特丹、汉堡等主要港口效率提升。', href: '/pages/news/detail.html', cover: '/assets/images/4cosco.webp', publishDate: '2025-01-08T14:30', source: '媒体', tags: ['港口','供应链'], heat: 135 },
            { id: 'n3', title: '绿色航运推进：多家船公司试点甲醇动力', summary: 'IMO 环保指标推动下的低碳实践。', href: '/pages/news/detail.html', cover: '/assets/images/6one.webp', publishDate: '2025-01-05T11:20', source: '自采', tags: ['绿色','政策'], heat: 160 },
            { id: 'n4', title: '数字化货代服务升级，在线订舱更便捷', summary: '平台化与智能化为中小货代赋能。', href: '/pages/news/detail.html', cover: '/assets/images/2msk.webp', publishDate: '2025-01-03T16:00', source: '媒体', tags: ['数字化','货代'], heat: 120 },
            { id: 'n5', title: '东南亚港口扩建，区域物流活力增强', summary: '新加坡、泰国、越南等地相继扩建码头。', href: '/pages/news/detail.html', cover: '/assets/images/7emc.webp', publishDate: '2024-12-30T08:45', source: '官方公告', tags: ['港口','东南亚'], heat: 90 }
          ];
          localStorage.setItem('home_news', JSON.stringify(sampleNews));
          // 侧边栏示例配置
          localStorage.setItem('news_side_author', JSON.stringify({ avatar: '/assets/images/logo.webp', name: 'AI智货代编辑部', bio: '聚焦航运与货代行业趋势与干货分享。' }));
          localStorage.setItem('news_side_guests', JSON.stringify([
            { avatar: '/assets/images/2msk.webp', name: '马士基资深顾问', intro: '解读航线与市场策略' },
            { avatar: '/assets/images/4cosco.webp', name: '中远海运分析师', intro: '货代数字化实践' },
            { avatar: '/assets/images/6one.webp', name: 'ONE运营经理', intro: '东南亚港口洞察' }
          ]));
          localStorage.setItem('news_side_tags', JSON.stringify(['航线','港口','集装箱','运价','数字化','供应链']));
          // 触发前台监听
          localStorage.setItem('home_shipowners_cards_updated', Date.now().toString());
          localStorage.setItem('ports_db_updated', Date.now().toString());
          localStorage.setItem('home_news_updated', Date.now().toString());
          alert('已注入示例数据：船东卡片与端口库。请切换到首页验证下拉与跳转。');
          // 立即刷新当前列表渲染
          renderHomeOwners();
          renderPorts();
          renderNewsLib();
        } catch (e) {
          console.warn('seedTestData error', e);
        }
      })();

      // 首页模块配置（tools/mall/museum/leads）
      const defaultHomeConfig = {
        tools: {
          title: '实用工具', enterText: '进入实用工具', enterLink: 'pages/tools/index.html',
          items: [
            { name: '运价查询', link: 'pages/tools/freight-query.html', download: '', image: '', content: '按起运港与目的港跳转至设定的运价查询页面。' },
            { name: '集装箱尺寸与换算', link: 'pages/tools/container-size.html', download: '', image: '', content: '常见箱型尺寸与体积重量换算工具。' },
            { name: '费用/报价计算器', link: 'pages/tools/quote-calculator.html', download: '', image: '', content: '常见费用项与报价试算（示例）。' }
          ]
        },
        mall: { title: '积分商城', enterText: '进入积分商城', enterLink: 'pages/points-mall/index.html' },
        museum: { title: '集卡博物馆', enterText: '进入集卡博物馆', enterLink: 'pages/jika-museum/index.html' },
        leads: {
          title: '获客中心',
          items: [
            { name: '本地货代', desc: '对接本地/全国货代伙伴', link: 'pages/leads/index.html?type=本地货代' },
            { name: '海外代理', desc: '拓展海外船东与代理网', link: 'pages/leads/index.html?type=海外代理' },
            { name: '国内工厂', desc: '链接制造端直客需求', link: 'pages/leads/index.html?type=国内工厂' },
            { name: '海外买家', desc: '对接进口买家与渠道', link: 'pages/leads/index.html?type=海外买家' }
          ]
        }
      };
      function loadHomeConfig() {
        try {
          const raw = localStorage.getItem('site_home_config');
          if (!raw) return JSON.parse(JSON.stringify(defaultHomeConfig));
          const cfg = JSON.parse(raw);
          return { ...defaultHomeConfig, ...cfg,
            tools: {
              ...defaultHomeConfig.tools,
              ...(cfg.tools||{}),
              items: Array.isArray(cfg.tools && cfg.tools.items) ? cfg.tools.items : defaultHomeConfig.tools.items
            },
            mall: { ...defaultHomeConfig.mall, ...(cfg.mall||{}) },
            museum: { ...defaultHomeConfig.museum, ...(cfg.museum||{}) },
            leads: {
              title: (cfg.leads && cfg.leads.title) || defaultHomeConfig.leads.title,
              items: Array.isArray(cfg.leads && cfg.leads.items) ? cfg.leads.items.map((it, i) => ({
                name: it.name || defaultHomeConfig.leads.items[i]?.name || '',
                desc: it.desc || defaultHomeConfig.leads.items[i]?.desc || '',
                link: it.link || defaultHomeConfig.leads.items[i]?.link || '#'
              })) : defaultHomeConfig.leads.items
            }
          };
        } catch(e) {
          console.error('读取首页配置失败', e);
          return JSON.parse(JSON.stringify(defaultHomeConfig));
        }
      }
      function saveHomeConfig(cfg) {
        try {
          if (window.APP_API && window.APP_API.set) {
            window.APP_API.set('site_home_config', cfg).then(function(){ localStorage.setItem('site_home_config_updated', String(Date.now())); alert('已保存首页配置'); });
          } else {
            localStorage.setItem('site_home_config', JSON.stringify(cfg));
            localStorage.setItem('site_home_config_updated', String(Date.now()));
            alert('已保存首页配置');
          }
        } catch(e) { alert('保存失败：' + e.message); }
      }
      function fillForm(cfg) {
        t('tools-title').value = cfg.tools.title;
        t('tools-enter-text').value = cfg.tools.enterText;
        t('tools-enter-link').value = cfg.tools.enterLink;
        toolsItems = Array.isArray(cfg.tools.items) ? cfg.tools.items.slice() : [];
        renderToolsItems();
        t('mall-title').value = cfg.mall.title;
        t('mall-enter-text').value = cfg.mall.enterText;
        t('mall-enter-link').value = cfg.mall.enterLink;
        t('museum-title').value = cfg.museum.title;
        t('museum-enter-text').value = cfg.museum.enterText;
        t('museum-enter-link').value = cfg.museum.enterLink;
        t('leads-title').value = cfg.leads.title;
        cfg.leads.items.forEach((it, i) => {
          t(`leads-item-${i}-name`).value = it.name;
          t(`leads-item-${i}-desc`).value = it.desc;
          t(`leads-item-${i}-link`).value = it.link;
        });
      }
      function collectFormConfig() {
        const cfg = {
          tools: { title: t('tools-title').value.trim(), enterText: t('tools-enter-text').value.trim(), enterLink: t('tools-enter-link').value.trim(), items: toolsItems },
          mall: { title: t('mall-title').value.trim(), enterText: t('mall-enter-text').value.trim(), enterLink: t('mall-enter-link').value.trim() },
          museum: { title: t('museum-title').value.trim(), enterText: t('museum-enter-text').value.trim(), enterLink: t('museum-enter-link').value.trim() },
          leads: {
            title: t('leads-title').value.trim(),
            items: [0,1,2,3].map(i => ({
              name: t(`leads-item-${i}-name`).value.trim(),
              desc: t(`leads-item-${i}-desc`).value.trim(),
              link: t(`leads-item-${i}-link`).value.trim() || '#'
            }))
          }
        };
        return cfg;
      }
      const homeCfg = loadHomeConfig(); fillForm(homeCfg);
      t('btn-save').addEventListener('click', function(){ saveHomeConfig(collectFormConfig()); });
      t('btn-reset').addEventListener('click', function(){ fillForm(defaultHomeConfig); saveHomeConfig(defaultHomeConfig); });
      t('btn-apply').addEventListener('click', function(){ saveHomeConfig(collectFormConfig()); alert('已写入配置。请切换到首页查看效果。'); });

      const loginSideKey = 'login_side_config';
      let loginBullets = [];
      function loadLoginSide(){
        const cfg = JSON.parse(localStorage.getItem(loginSideKey)||'{}');
        t('login-side-title-input').value = cfg.title || '登录后您可以';
        t('login-side-cta-text').value = cfg.ctaText || '会员升级/开通';
        t('login-side-cta-href').value = cfg.ctaHref || '/pages/user/upgrade.html';
        loginBullets = Array.isArray(cfg.bullets) ? cfg.bullets.slice() : ['· 查看与管理订单/询价','· 管理邀请与积分明细','· 升级会员、查看会员权益','· 企业会员申请与客服工单'];
        renderLoginBullets();
      }
      function saveLoginSide(){
        const data = {
          title: t('login-side-title-input').value.trim() || '登录后您可以',
          bullets: loginBullets,
          ctaText: t('login-side-cta-text').value.trim() || '会员升级/开通',
          ctaHref: t('login-side-cta-href').value.trim() || '/pages/user/upgrade.html'
        };
        localStorage.setItem(loginSideKey, JSON.stringify(data));
        localStorage.setItem('login_side_config_updated', Date.now().toString());
        alert('已保存登录页右侧文案');
      }
      function renderLoginBullets(){
        const box = t('login-side-bullets-list'); box.innerHTML='';
        loginBullets.forEach(function(text, idx){
          const row = document.createElement('div'); row.className='flex items-center gap-2';
          const input = document.createElement('input'); input.className='flex-1 border rounded px-3 py-2'; input.value = text;
          const btnSave = document.createElement('button'); btnSave.type='button'; btnSave.className='btn-secondary'; btnSave.innerHTML='<i class="fas fa-save mr-2"></i>保存';
          const btnDel = document.createElement('button'); btnDel.type='button'; btnDel.className='btn-secondary'; btnDel.innerHTML='<i class="fas fa-trash mr-2"></i>删除';
          btnSave.addEventListener('click', function(){ loginBullets[idx] = input.value.trim(); saveLoginSide(); });
          btnDel.addEventListener('click', function(){ loginBullets.splice(idx,1); renderLoginBullets(); });
          row.appendChild(input); row.appendChild(btnSave); row.appendChild(btnDel); box.appendChild(row);
        });
      }
      t('login-side-add').addEventListener('click', function(){ const v = t('login-side-new-bullet').value.trim(); if (!v) return; loginBullets.push(v); t('login-side-new-bullet').value=''; renderLoginBullets(); });
      t('login-side-bullets-clear').addEventListener('click', function(){ if (!confirm('确认清空所有简介条目？')) return; loginBullets=[]; renderLoginBullets(); });
      t('login-side-bullets-save').addEventListener('click', saveLoginSide);
      loadLoginSide();
    });
  </script>
<script>
  (function(){
    try {
      const u = JSON.parse(localStorage.getItem('yx_user'));
      if (!u || u.role !== 'super_admin') {
        alert('该页面仅限超级管理员访问，请使用管理员账号登录。');
        window.location.href = '/pages/user/login.html';
      }
    } catch (e) {
      window.location.href = '/pages/user/login.html';
    }
  })();
</script>
</body>
</html>